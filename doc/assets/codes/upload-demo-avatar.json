{"highlightCode":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Observable<span class=\"token punctuation\">,</span> Observer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzMessageService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/message'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzUploadFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/upload'</span><span class=\"token punctuation\">;</span>\r\n\r\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'nz-demo-upload-avatar'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token template-string\">template: <span class=\"token html\">`\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-upload</span>\r\n      <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>avatar-uploader<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">nzAction</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://www.mocky.io/v2/5cc8019d300000980a055e76<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">nzName</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>avatar<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">nzListType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>picture-card<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[nzShowUploadList]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[nzBeforeUpload]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>beforeUpload<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">(nzChange)</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>handleChange($event)<span class=\"token punctuation\">\"</span></span>\r\n    <span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ng-container</span> <span class=\"token attr-name\">*ngIf</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>!avatarUrl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>upload-icon<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">nz-icon</span> <span class=\"token attr-name\">[nzType]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>loading ? <span class=\"token punctuation\">'</span>loading<span class=\"token punctuation\">'</span> : <span class=\"token punctuation\">'</span>plus<span class=\"token punctuation\">'</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\r\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ant-upload-text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ng-container</span><span class=\"token punctuation\">></span></span>\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">*ngIf</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>avatarUrl<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[src]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>avatarUrl<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100%</span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-upload</span><span class=\"token punctuation\">></span></span>\r\n  `</span></span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token styles-string\">styles: [\r\n    <span class=\"token css\"><span class=\"token selector\">`\r\n      <span class=\"token pseudo-class\">:host</span> <span class=\"token pseudo-element\">::ng-deep</span> <span class=\"token class\">.avatar-uploader</span> > <span class=\"token class\">.ant-upload</span> </span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">128</span>px<span class=\"token punctuation\">;</span>\r\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">128</span>px<span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    `</span>\r\n  ]</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NzDemoUploadAvatarComponent</span> <span class=\"token punctuation\">{</span>\r\n  loading <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\r\n  avatarUrl<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> msg<span class=\"token punctuation\">:</span> NzMessageService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n  beforeUpload <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">,</span> _fileList<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">boolean</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\r\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Observable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">:</span> Observer<span class=\"token operator\">&lt;</span><span class=\"token keyword\">boolean</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> isJpgOrPng <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'image/jpeg'</span> <span class=\"token operator\">||</span> file<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'image/png'</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isJpgOrPng<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You can only upload JPG file!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      <span class=\"token keyword\">const</span> isLt2M <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>size<span class=\"token operator\">!</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isLt2M<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Image must smaller than 2MB!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span>isJpgOrPng <span class=\"token operator\">&amp;&amp;</span> isLt2M<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getBase64</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">:</span> File<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">:</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    reader<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">.</span>result<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token function\">handleChange</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> file<span class=\"token punctuation\">:</span> NzUploadFile <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'uploading'</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'done'</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token comment\" spellcheck=\"true\">// Get this url from response in real world.</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBase64</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>file<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>originFileObj<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">:</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\r\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>avatarUrl <span class=\"token operator\">=</span> img<span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Network error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n","rawCode":"import { Component } from '@angular/core';\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport { NzMessageService } from 'ng-zorro-antd/message';\r\nimport { NzUploadFile } from 'ng-zorro-antd/upload';\r\n\r\n@Component({\r\n  selector: 'nz-demo-upload-avatar',\r\n  template: `\r\n    <nz-upload\r\n      class=\"avatar-uploader\"\r\n      nzAction=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\r\n      nzName=\"avatar\"\r\n      nzListType=\"picture-card\"\r\n      [nzShowUploadList]=\"false\"\r\n      [nzBeforeUpload]=\"beforeUpload\"\r\n      (nzChange)=\"handleChange($event)\"\r\n    >\r\n      <ng-container *ngIf=\"!avatarUrl\">\r\n        <span class=\"upload-icon\" nz-icon [nzType]=\"loading ? 'loading' : 'plus'\"></span>\r\n        <div class=\"ant-upload-text\">Upload</div>\r\n      </ng-container>\r\n      <img *ngIf=\"avatarUrl\" [src]=\"avatarUrl\" style=\"width: 100%\" />\r\n    </nz-upload>\r\n  `,\r\n  styles: [\r\n    `\r\n      :host ::ng-deep .avatar-uploader > .ant-upload {\r\n        width: 128px;\r\n        height: 128px;\r\n      }\r\n    `\r\n  ]\r\n})\r\nexport class NzDemoUploadAvatarComponent {\r\n  loading = false;\r\n  avatarUrl?: string;\r\n\r\n  constructor(private msg: NzMessageService) {}\r\n\r\n  beforeUpload = (file: NzUploadFile, _fileList: NzUploadFile[]): Observable<boolean> =>\r\n    new Observable((observer: Observer<boolean>) => {\r\n      const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\r\n      if (!isJpgOrPng) {\r\n        this.msg.error('You can only upload JPG file!');\r\n        observer.complete();\r\n        return;\r\n      }\r\n      const isLt2M = file.size! / 1024 / 1024 < 2;\r\n      if (!isLt2M) {\r\n        this.msg.error('Image must smaller than 2MB!');\r\n        observer.complete();\r\n        return;\r\n      }\r\n      observer.next(isJpgOrPng && isLt2M);\r\n      observer.complete();\r\n    });\r\n\r\n  private getBase64(img: File, callback: (img: string) => void): void {\r\n    const reader = new FileReader();\r\n    reader.addEventListener('load', () => callback(reader.result!.toString()));\r\n    reader.readAsDataURL(img);\r\n  }\r\n\r\n  handleChange(info: { file: NzUploadFile }): void {\r\n    switch (info.file.status) {\r\n      case 'uploading':\r\n        this.loading = true;\r\n        break;\r\n      case 'done':\r\n        // Get this url from response in real world.\r\n        this.getBase64(info.file!.originFileObj!, (img: string) => {\r\n          this.loading = false;\r\n          this.avatarUrl = img;\r\n        });\r\n        break;\r\n      case 'error':\r\n        this.msg.error('Network error');\r\n        this.loading = false;\r\n        break;\r\n    }\r\n  }\r\n}\r\n"}
