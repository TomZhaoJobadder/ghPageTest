{"highlightCode":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzUploadChangeParam<span class=\"token punctuation\">,</span> NzUploadFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/upload'</span><span class=\"token punctuation\">;</span>\r\n\r\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'nz-demo-upload-upload-with-aliyun-oss'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token template-string\">template: <span class=\"token html\">`\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-upload</span>\r\n      <span class=\"token attr-name\">nzName</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[(nzFileList)]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>files<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[nzTransformFile]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>transformFile<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[nzData]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>getExtraData<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">[nzAction]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mockOSSData.host<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token attr-name\">(nzChange)</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>onChange($event)<span class=\"token punctuation\">\"</span></span>\r\n    <span class=\"token punctuation\">></span></span>\r\n      Photos:\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">nz-button</span><span class=\"token punctuation\">></span></span>\r\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">nz-icon</span> <span class=\"token attr-name\">nzType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>upload<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\r\n        Click to Upload\r\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-upload</span><span class=\"token punctuation\">></span></span>\r\n  `</span></span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NzDemoUploadUploadWithAliyunOssComponent</span> <span class=\"token punctuation\">{</span>\r\n  files<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  mockOSSData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    dir<span class=\"token punctuation\">:</span> <span class=\"token string\">'user-dir/'</span><span class=\"token punctuation\">,</span>\r\n    expire<span class=\"token punctuation\">:</span> <span class=\"token string\">'1577811661'</span><span class=\"token punctuation\">,</span>\r\n    host<span class=\"token punctuation\">:</span> <span class=\"token string\">'//www.mocky.io/v2/5cc8019d300000980a055e76'</span><span class=\"token punctuation\">,</span>\r\n    accessId<span class=\"token punctuation\">:</span> <span class=\"token string\">'c2hhb2RhaG9uZw=='</span><span class=\"token punctuation\">,</span>\r\n    policy<span class=\"token punctuation\">:</span> <span class=\"token string\">'eGl4aWhhaGFrdWt1ZGFkYQ=='</span><span class=\"token punctuation\">,</span>\r\n    signature<span class=\"token punctuation\">:</span> <span class=\"token string\">'ZGFob25nc2hhbw=='</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  transformFile <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> NzUploadFile <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> suffix <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">;</span>\r\n    file<span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockOSSData<span class=\"token punctuation\">.</span>dir <span class=\"token operator\">+</span> filename<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> file<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  getExtraData <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> accessId<span class=\"token punctuation\">,</span> policy<span class=\"token punctuation\">,</span> signature <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockOSSData<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\r\n      key<span class=\"token punctuation\">:</span> file<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span>\r\n      OSSAccessKeyId<span class=\"token punctuation\">:</span> accessId<span class=\"token punctuation\">,</span>\r\n      policy<span class=\"token punctuation\">,</span>\r\n      Signature<span class=\"token punctuation\">:</span> signature\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token function\">onChange</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">:</span> NzUploadChangeParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\r\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aliyun OSS:'</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>fileList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n","rawCode":"import { Component } from '@angular/core';\r\n\r\nimport { NzUploadChangeParam, NzUploadFile } from 'ng-zorro-antd/upload';\r\n\r\n@Component({\r\n  selector: 'nz-demo-upload-upload-with-aliyun-oss',\r\n  template: `\r\n    <nz-upload\r\n      nzName=\"file\"\r\n      [(nzFileList)]=\"files\"\r\n      [nzTransformFile]=\"transformFile\"\r\n      [nzData]=\"getExtraData\"\r\n      [nzAction]=\"mockOSSData.host\"\r\n      (nzChange)=\"onChange($event)\"\r\n    >\r\n      Photos:\r\n      <button nz-button>\r\n        <span nz-icon nzType=\"upload\"></span>\r\n        Click to Upload\r\n      </button>\r\n    </nz-upload>\r\n  `\r\n})\r\nexport class NzDemoUploadUploadWithAliyunOssComponent {\r\n  files: NzUploadFile[] = [];\r\n  mockOSSData = {\r\n    dir: 'user-dir/',\r\n    expire: '1577811661',\r\n    host: '//www.mocky.io/v2/5cc8019d300000980a055e76',\r\n    accessId: 'c2hhb2RhaG9uZw==',\r\n    policy: 'eGl4aWhhaGFrdWt1ZGFkYQ==',\r\n    signature: 'ZGFob25nc2hhbw=='\r\n  };\r\n\r\n  transformFile = (file: NzUploadFile): NzUploadFile => {\r\n    const suffix = file.name.slice(file.name.lastIndexOf('.'));\r\n    const filename = Date.now() + suffix;\r\n    file.url = this.mockOSSData.dir + filename;\r\n\r\n    return file;\r\n  };\r\n\r\n  getExtraData = (file: NzUploadFile): {} => {\r\n    const { accessId, policy, signature } = this.mockOSSData;\r\n\r\n    return {\r\n      key: file.url,\r\n      OSSAccessKeyId: accessId,\r\n      policy,\r\n      Signature: signature\r\n    };\r\n  };\r\n\r\n  onChange(e: NzUploadChangeParam): void {\r\n    console.log('Aliyun OSS:', e.fileList);\r\n  }\r\n}\r\n"}
